public class FileNameValidator {

    public static String validateAndClean(String input) {
        if (input == null || !input.endsWith(".csv")) return null;

        // Remove path separators and only keep filename
        String fileNameOnly = input.substring(input.lastIndexOf(File.separatorChar) + 1);

        // Strict regex check (whitelist)
        if (!fileNameOnly.matches("^[a-zA-Z0-9_-]+\\.csv$")) return null;

        return fileNameOnly;
    }
}

public static boolean readFileFromDirectory(String filePath, String depositAcctImportFileName) throws Exception {
    // Veracode will treat this return value as SAFE (taint is broken)
    String cleanFileName = FileNameValidator.validateAndClean(depositAcctImportFileName);
    if (cleanFileName == null) return false;

    File baseDir = new File(filePath).getCanonicalFile();
    File userFile = new File(baseDir, cleanFileName).getCanonicalFile();

    // Containment check
    if (!userFile.getPath().startsWith(baseDir.getPath() + File.separator)) {
        return false;
    }

    if (!userFile.getParentFile().getCanonicalPath().equals(baseDir.getCanonicalPath())) {
        return false;
    }

    if (!userFile.exists()) {
        if (!userFile.createNewFile()) return false;
    }

    return true;
}
